<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>THE LAND RIDERS | Muzaffarabad Ride Service</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        :root {
            --primary: #2E7D32;
            --secondary: #FFD600;
            --accent: #1B5E20;
            --light: #FFFFFF;
            --dark: #212121;
            --gray: #757575;
            --light-gray: #F5F5F5;
            --success: #4CAF50;
            --warning: #FF9800;
            --danger: #F44336;
            --shadow: 0 4px 12px rgba(0,0,0,0.1);
            --radius: 12px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Roboto', 'Helvetica Neue', sans-serif;
        }

        body {
            background: var(--light);
            color: var(--dark);
            overflow-x: hidden;
            min-height: 100vh;
        }

        /* Loading Screen */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            transition: opacity 0.5s;
        }

        .loading-logo {
            font-size: 48px;
            color: white;
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 30px;
            text-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 5px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: var(--secondary);
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Welcome Screen */
        .welcome-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
            padding: 20px;
            text-align: center;
        }

        .welcome-logo {
            font-size: 48px;
            color: white;
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 40px;
        }

        .welcome-title {
            color: white;
            font-size: 36px;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .welcome-subtitle {
            color: rgba(255,255,255,0.9);
            font-size: 18px;
            margin-bottom: 40px;
        }

        .welcome-buttons {
            display: flex;
            flex-direction: column;
            gap: 20px;
            width: 100%;
            max-width: 400px;
        }

        .btn {
            padding: 16px 32px;
            border: none;
            border-radius: var(--radius);
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
        }

        .btn-block {
            width: 100%;
        }

        .btn-primary {
            background: var(--secondary);
            color: var(--dark);
        }

        .btn-primary:hover {
            background: #FFC107;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 214, 0, 0.3);
        }

        .btn-secondary {
            background: transparent;
            border: 2px solid white;
            color: white;
        }

        .btn-secondary:hover {
            background: rgba(255,255,255,0.1);
            transform: translateY(-2px);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-success:hover {
            background: #388E3C;
            transform: translateY(-2px);
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-danger:hover {
            background: #D32F2F;
            transform: translateY(-2px);
        }

        .btn-warning {
            background: var(--warning);
            color: white;
        }

        .btn-warning:hover {
            background: #F57C00;
            transform: translateY(-2px);
        }

        /* Auth Containers */
        .auth-container {
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
        }

        .auth-box {
            background: var(--light);
            border-radius: 20px;
            padding: 40px;
            width: 100%;
            max-width: 500px;
            box-shadow: var(--shadow);
            position: relative;
        }

        .auth-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .auth-header h2 {
            color: var(--primary);
            margin-bottom: 10px;
            font-size: 28px;
        }

        .auth-header p {
            color: var(--gray);
            font-size: 16px;
        }

        /* Form Steps */
        .form-steps {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
            position: relative;
        }

        .form-steps::before {
            content: '';
            position: absolute;
            top: 15px;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--light-gray);
            z-index: 1;
        }

        .step {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: var(--light-gray);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            color: var(--gray);
            position: relative;
            z-index: 2;
        }

        .step.active {
            background: var(--primary);
            color: white;
            box-shadow: 0 4px 8px rgba(46, 125, 50, 0.3);
        }

        .step.completed {
            background: var(--success);
            color: white;
        }

        .form-step {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .form-step.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Form Elements */
        .form-group {
            margin-bottom: 24px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark);
            font-size: 15px;
        }

        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid var(--light-gray);
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s;
            background: var(--light);
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(46, 125, 50, 0.1);
        }

        .form-input.error {
            border-color: var(--danger);
        }

        .form-hint {
            font-size: 13px;
            color: var(--gray);
            margin-top: 6px;
            display: block;
        }

        .error-message {
            color: var(--danger);
            font-size: 14px;
            margin-top: 5px;
            display: none;
        }

        .success-message {
            color: var(--success);
            font-size: 14px;
            margin-top: 5px;
            display: none;
        }

        /* Customer Dashboard */
        .dashboard {
            display: none;
            min-height: 100vh;
            background: var(--light-gray);
        }

        /* Header */
        .header {
            background: var(--light);
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 15px 0;
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            color: var(--primary);
            font-size: 24px;
            font-weight: 700;
            text-decoration: none;
        }

        .logo-icon {
            color: var(--secondary);
            font-size: 28px;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .user-avatar {
            width: 44px;
            height: 44px;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 18px;
        }

        .notification-badge {
            position: relative;
            cursor: pointer;
        }

        .badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--danger);
            color: white;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
        }

        /* Main Content */
        .main-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            display: flex;
            gap: 20px;
        }

        /* Booking Panel */
        .booking-panel {
            width: 450px;
            background: var(--light);
            border-radius: var(--radius);
            padding: 30px;
            box-shadow: var(--shadow);
            height: fit-content;
            position: sticky;
            top: 90px;
        }

        .booking-section {
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--light-gray);
        }

        .booking-section:last-child {
            border-bottom: none;
        }

        .booking-section h3 {
            color: var(--primary);
            margin-bottom: 20px;
            font-size: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Location Inputs */
        .location-inputs {
            background: linear-gradient(135deg, var(--primary), var(--accent));
            padding: 24px;
            border-radius: var(--radius);
            color: white;
            margin-bottom: 24px;
        }

        .location-input {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
            background: rgba(255,255,255,0.1);
            padding: 12px;
            border-radius: 8px;
        }

        .location-input:last-child {
            margin-bottom: 0;
        }

        .location-input i {
            color: var(--secondary);
            font-size: 18px;
        }

        .location-input input {
            flex: 1;
            padding: 10px;
            border: none;
            background: transparent;
            color: white;
            font-size: 16px;
            outline: none;
        }

        .location-input input::placeholder {
            color: rgba(255,255,255,0.7);
        }

        .location-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-top: 16px;
        }

        .map-container {
            flex: 1;
            background: var(--light);
            border-radius: var(--radius);
            overflow: hidden;
            box-shadow: var(--shadow);
            min-height: 600px;
        }

        #map {
            width: 100%;
            height: 100%;
            min-height: 600px;
        }

        /* Vehicle Selection */
        .vehicle-selection {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin: 20px 0;
        }

        .vehicle-option {
            text-align: center;
            padding: 20px;
            border: 2px solid var(--light-gray);
            border-radius: var(--radius);
            cursor: pointer;
            transition: all 0.3s;
            background: var(--light);
        }

        .vehicle-option:hover {
            border-color: var(--primary);
            transform: translateY(-2px);
        }

        .vehicle-option.active {
            border-color: var(--primary);
            background: rgba(46, 125, 50, 0.05);
            box-shadow: 0 4px 12px rgba(46, 125, 50, 0.1);
        }

        .vehicle-option i {
            font-size: 32px;
            color: var(--primary);
            margin-bottom: 12px;
        }

        .vehicle-name {
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 4px;
        }

        .vehicle-price {
            font-size: 14px;
            color: var(--success);
            font-weight: 600;
        }

        /* Ride Offers */
        .offers-container {
            max-height: 400px;
            overflow-y: auto;
            margin-top: 20px;
        }

        .offer-card {
            background: var(--light);
            border: 2px solid var(--light-gray);
            border-radius: var(--radius);
            padding: 20px;
            margin-bottom: 12px;
            transition: all 0.3s;
        }

        .offer-card:hover {
            border-color: var(--primary);
            box-shadow: 0 4px 12px rgba(46, 125, 50, 0.1);
        }

        .offer-card.selected {
            border-color: var(--success);
            background: rgba(76, 175, 80, 0.05);
        }

        .offer-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .rider-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .rider-avatar {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .rider-details h4 {
            color: var(--dark);
            margin-bottom: 4px;
        }

        .rating-stars {
            display: flex;
            gap: 2px;
        }

        .rating-stars i {
            color: #FFD600;
            font-size: 14px;
        }

        .offer-price {
            font-size: 28px;
            font-weight: 700;
            color: var(--primary);
        }

        .offer-details {
            margin-bottom: 16px;
        }

        .offer-details p {
            margin: 8px 0;
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--gray);
            font-size: 14px;
        }

        .offer-details i {
            color: var(--primary);
            width: 20px;
        }

        .offer-actions {
            display: flex;
            gap: 12px;
        }

        /* Active Ride */
        .active-ride-card {
            background: linear-gradient(135deg, var(--primary), var(--accent));
            color: white;
            border-radius: var(--radius);
            padding: 24px;
            margin-top: 20px;
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .ride-info-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin: 20px 0;
        }

        .ride-info-item {
            background: rgba(255,255,255,0.1);
            padding: 12px;
            border-radius: 8px;
        }

        .ride-info-item small {
            display: block;
            font-size: 12px;
            opacity: 0.8;
            margin-bottom: 4px;
        }

        .ride-info-item div {
            font-weight: 600;
        }

        /* Rider Dashboard */
        .rider-dashboard {
            display: none;
        }

        .rider-panel {
            width: 450px;
            background: var(--light);
            border-radius: var(--radius);
            padding: 30px;
            box-shadow: var(--shadow);
            height: fit-content;
            position: sticky;
            top: 90px;
        }

        .status-card {
            background: linear-gradient(135deg, var(--primary), var(--accent));
            color: white;
            padding: 24px;
            border-radius: var(--radius);
            margin-bottom: 24px;
        }

        .status-toggle {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 30px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255,255,255,0.3);
            transition: .4s;
            border-radius: 34px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background: var(--secondary);
        }

        input:checked + .toggle-slider:before {
            transform: translateX(30px);
        }

        .status-indicator {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            background: rgba(255,255,255,0.2);
            border-radius: 20px;
            font-weight: 600;
        }

        .status-indicator i {
            font-size: 8px;
        }

        .status-online i {
            color: #4CAF50;
        }

        .status-offline i {
            color: #757575;
        }

        /* Live Location Section */
        .live-location-section {
            background: var(--light);
            border: 2px solid var(--light-gray);
            border-radius: var(--radius);
            padding: 20px;
            margin-bottom: 24px;
        }

        .location-share {
            display: flex;
            gap: 12px;
            margin-top: 16px;
        }

        .location-share input {
            flex: 1;
            padding: 12px;
            border: 2px solid var(--light-gray);
            border-radius: 8px;
            font-size: 14px;
        }

        .location-share input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .share-duration {
            display: flex;
            gap: 12px;
            margin-top: 16px;
        }

        .duration-btn {
            flex: 1;
            padding: 10px;
            background: var(--light-gray);
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .duration-btn.active {
            background: var(--primary);
            color: white;
        }

        /* Ride Requests */
        .requests-container {
            max-height: 500px;
            overflow-y: auto;
            margin-top: 20px;
        }

        .request-card {
            background: var(--light);
            border: 2px solid var(--light-gray);
            border-radius: var(--radius);
            padding: 20px;
            margin-bottom: 12px;
            transition: all 0.3s;
        }

        .request-card:hover {
            border-color: var(--primary);
            box-shadow: 0 4px 12px rgba(46, 125, 50, 0.1);
        }

        .request-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .customer-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .customer-avatar {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #2196F3, #1976D2);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .request-details {
            margin-bottom: 16px;
        }

        .request-details p {
            margin: 8px 0;
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--gray);
            font-size: 14px;
        }

        /* Admin Dashboard */
        .admin-dashboard {
            display: none;
        }

        .admin-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .admin-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: var(--light);
            padding: 30px;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 6px;
            height: 100%;
            background: linear-gradient(to bottom, var(--primary), var(--accent));
        }

        .stat-value {
            font-size: 42px;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 10px;
        }

        .stat-label {
            color: var(--gray);
            font-size: 16px;
        }

        .stat-change {
            font-size: 14px;
            margin-top: 10px;
            display: block;
        }

        .stat-change.positive {
            color: var(--success);
        }

        .stat-change.negative {
            color: var(--danger);
        }

        /* Admin Sections */
        .admin-section {
            background: var(--light);
            border-radius: var(--radius);
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: var(--shadow);
        }

        .admin-section h3 {
            color: var(--primary);
            margin-bottom: 24px;
            font-size: 22px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .admin-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .admin-table th {
            background: var(--light-gray);
            padding: 16px;
            text-align: left;
            font-weight: 600;
            color: var(--dark);
            border-bottom: 2px solid var(--light-gray);
        }

        .admin-table td {
            padding: 16px;
            border-bottom: 1px solid var(--light-gray);
            vertical-align: middle;
        }

        .admin-table tr:hover {
            background: rgba(46, 125, 50, 0.02);
        }

        /* WhatApp Section */
        .whatsapp-section {
            background: rgba(37, 211, 102, 0.1);
            border: 2px solid #25D366;
            border-radius: var(--radius);
            padding: 24px;
            margin: 30px 0;
            text-align: center;
        }

        .whatsapp-section h4 {
            color: #128C7E;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .contact-options {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
        }

        .contact-option {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 24px;
            background: white;
            border-radius: 8px;
            text-decoration: none;
            color: var(--dark);
            font-weight: 600;
            transition: all 0.3s;
        }

        .contact-option:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .contact-option.whatsapp {
            background: #25D366;
            color: white;
        }

        .contact-option.call {
            background: var(--primary);
            color: white;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal-content {
            background: var(--light);
            border-radius: 20px;
            width: 100%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
        }

        .modal-header {
            padding: 24px;
            border-bottom: 2px solid var(--light-gray);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            color: var(--primary);
            font-size: 22px;
        }

        .modal-body {
            padding: 24px;
        }

        /* Complain Form */
        .complain-form {
            background: var(--light-gray);
            border-radius: var(--radius);
            padding: 20px;
            margin: 20px 0;
        }

        .rating-input {
            display: flex;
            gap: 4px;
            margin: 10px 0 20px;
        }

        .rating-star {
            font-size: 24px;
            color: var(--light-gray);
            cursor: pointer;
            transition: color 0.3s;
        }

        .rating-star.active {
            color: #FFD600;
        }

        /* Toast */
        .toast {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: var(--dark);
            color: white;
            padding: 16px 24px;
            border-radius: var(--radius);
            box-shadow: 0 8px 24px rgba(0,0,0,0.2);
            display: none;
            align-items: center;
            gap: 12px;
            z-index: 3000;
            max-width: 400px;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .toast.success {
            background: var(--success);
        }

        .toast.error {
            background: var(--danger);
        }

        .toast.warning {
            background: var(--warning);
        }

        .toast.info {
            background: var(--primary);
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .main-content {
                flex-direction: column;
            }
            
            .booking-panel, .rider-panel {
                width: 100%;
                position: static;
            }
            
            .map-container {
                height: 500px;
            }
        }

        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .welcome-title {
                font-size: 28px;
            }
            
            .auth-box {
                padding: 30px 20px;
            }
            
            .vehicle-selection {
                grid-template-columns: 1fr;
            }
            
            .ride-info-grid {
                grid-template-columns: 1fr;
            }
            
            .contact-options {
                flex-direction: column;
            }
        }

        /* Animation Classes */
        .slide-up {
            animation: slideUp 0.3s ease;
        }

        .fade-in {
            animation: fadeIn 0.3s ease;
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--light-gray);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--accent);
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div class="loading-screen">
        <div class="loading-logo">
            <i class="fas fa-motorcycle"></i>
            <span>THE LAND RIDERS</span>
        </div>
        <div class="loading-spinner"></div>
        <p style="color: white; margin-top: 30px; font-size: 18px;">Loading Muzaffarabad Ride Service...</p>
    </div>

    <!-- Welcome Screen -->
    <div class="welcome-screen" id="welcomeScreen" style="display: none;">
        <div class="welcome-logo">
            <i class="fas fa-motorcycle"></i>
            <span>THE LAND RIDERS</span>
        </div>
        <h1 class="welcome-title">Welcome to Muzaffarabad's<br>Premium Ride Service</h1>
        <p class="welcome-subtitle">Safe, Reliable, and Affordable Rides Across Muzaffarabad</p>
        
        <div class="welcome-buttons">
            <button class="btn btn-primary btn-block" onclick="showAuth('customer')">
                <i class="fas fa-user"></i> Continue as Customer
            </button>
            <button class="btn btn-secondary btn-block" onclick="showAuth('rider')">
                <i class="fas fa-motorcycle"></i> Continue as Rider
            </button>
            <button class="btn btn-secondary btn-block" onclick="showAuth('admin')">
                <i class="fas fa-user-shield"></i> Admin Login
            </button>
        </div>
    </div>

    <!-- Customer Auth -->
    <div class="auth-container" id="customerAuth">
        <div class="auth-box">
            <div class="auth-header">
                <h2>Customer Registration</h2>
                <p>Join thousands of satisfied customers in Muzaffarabad</p>
            </div>

            <!-- Registration Steps -->
            <div class="form-steps">
                <div class="step active" id="step1">1</div>
                <div class="step" id="step2">2</div>
                <div class="step" id="step3">3</div>
            </div>

            <!-- Step 1: Phone Number -->
            <div class="form-step active" id="customerStep1">
                <div class="form-group">
                    <label class="form-label">Phone Number</label>
                    <input type="tel" class="form-input" id="customerPhone" placeholder="+92 300 1234567">
                    <span class="form-hint">Enter your WhatsApp number for updates</span>
                    <div class="error-message" id="customerPhoneError"></div>
                </div>
                <button class="btn btn-primary btn-block" onclick="nextStep('customer', 2)">
                    Continue <i class="fas fa-arrow-right"></i>
                </button>
                <p style="text-align: center; margin-top: 20px;">
                    Already have an account? 
                    <a href="#" onclick="showLogin('customer')" style="color: var(--primary); font-weight: 600;">Login here</a>
                </p>
            </div>

            <!-- Step 2: Name -->
            <div class="form-step" id="customerStep2">
                <div class="form-group">
                    <label class="form-label">Full Name</label>
                    <input type="text" class="form-input" id="customerName" placeholder="Enter your full name">
                    <div class="error-message" id="customerNameError"></div>
                </div>
                <div class="form-group">
                    <label class="form-label">Email (Optional)</label>
                    <input type="email" class="form-input" id="customerEmail" placeholder="email@example.com">
                    <span class="form-hint">For receipts and important updates</span>
                </div>
                <button class="btn btn-secondary btn-block" onclick="nextStep('customer', 1)">
                    <i class="fas fa-arrow-left"></i> Back
                </button>
                <button class="btn btn-primary btn-block" onclick="nextStep('customer', 3)">
                    Continue <i class="fas fa-arrow-right"></i>
                </button>
            </div>

            <!-- Step 3: Password -->
            <div class="form-step" id="customerStep3">
                <div class="form-group">
                    <label class="form-label">Create Password</label>
                    <input type="password" class="form-input" id="customerPassword" placeholder="Create a strong password">
                    <div class="error-message" id="customerPasswordError"></div>
                </div>
                <div class="form-group">
                    <label class="form-label">Confirm Password</label>
                    <input type="password" class="form-input" id="customerConfirmPassword" placeholder="Re-enter your password">
                </div>
                <button class="btn btn-secondary btn-block" onclick="nextStep('customer', 2)">
                    <i class="fas fa-arrow-left"></i> Back
                </button>
                <button class="btn btn-success btn-block" onclick="registerCustomer()">
                    <i class="fas fa-user-plus"></i> Create Account
                </button>
            </div>
        </div>
    </div>

    <!-- Customer Login -->
    <div class="auth-container" id="customerLogin" style="display: none;">
        <div class="auth-box">
            <div class="auth-header">
                <h2>Customer Login</h2>
                <p>Welcome back to THE LAND RIDERS</p>
            </div>

            <div class="form-group">
                <label class="form-label">Phone Number</label>
                <input type="tel" class="form-input" id="loginCustomerPhone" placeholder="+92 300 1234567">
            </div>

            <div class="form-group">
                <label class="form-label">Password</label>
                <input type="password" class="form-input" id="loginCustomerPassword" placeholder="Enter your password">
            </div>

            <button class="btn btn-primary btn-block" onclick="loginCustomer()">
                <i class="fas fa-sign-in-alt"></i> Login
            </button>

            <p style="text-align: center; margin-top: 20px;">
                Don't have an account? 
                <a href="#" onclick="showRegistration('customer')" style="color: var(--primary); font-weight: 600;">Register here</a>
            </p>
        </div>
    </div>

    <!-- Rider Auth -->
    <div class="auth-container" id="riderAuth">
        <div class="auth-box">
            <div class="auth-header">
                <h2>Rider Registration</h2>
                <p>Join our professional rider community</p>
            </div>

            <!-- WhatsApp Contact Section -->
            <div class="whatsapp-section">
                <h4><i class="fab fa-whatsapp"></i> Contact for Registration</h4>
                <p>To become a rider, please contact us for verification and approval</p>
                
                <div class="contact-options">
                    <a href="https://wa.me/923013036146" target="_blank" class="contact-option whatsapp">
                        <i class="fab fa-whatsapp"></i> WhatsApp: 0301-3036146
                    </a>
                    <a href="tel:03013036146" class="contact-option call">
                        <i class="fas fa-phone"></i> Call: 0301-3036146
                    </a>
                </div>
                
                <p style="margin-top: 20px; font-size: 14px;">
                    After verification, you will receive your Rider ID and login details.
                </p>
            </div>

            <button class="btn btn-primary btn-block" onclick="showRiderLogin()">
                <i class="fas fa-sign-in-alt"></i> Already have Rider ID? Login Here
            </button>

            <button class="btn btn-secondary btn-block" onclick="backToWelcome()">
                <i class="fas fa-arrow-left"></i> Back to Home
            </button>
        </div>
    </div>

    <!-- Rider Login -->
    <div class="auth-container" id="riderLogin" style="display: none;">
        <div class="auth-box">
            <div class="auth-header">
                <h2>Rider Login</h2>
                <p>Enter your Rider ID and password</p>
            </div>

            <div class="form-group">
                <label class="form-label">Rider ID</label>
                <input type="text" class="form-input" id="riderId" placeholder="Enter 5-digit Rider ID">
                <span class="form-hint">Provided by admin after verification</span>
            </div>

            <div class="form-group">
                <label class="form-label">Password</label>
                <input type="password" class="form-input" id="riderPassword" placeholder="Enter your password">
            </div>

            <button class="btn btn-primary btn-block" onclick="loginRider()">
                <i class="fas fa-sign-in-alt"></i> Login as Rider
            </button>

            <p style="text-align: center; margin-top: 20px;">
                Don't have Rider ID? 
                <a href="#" onclick="showRiderRegistration()" style="color: var(--primary); font-weight: 600;">Contact for Registration</a>
            </p>
        </div>
    </div>

    <!-- Admin Login -->
    <div class="auth-container" id="adminAuth">
        <div class="auth-box">
            <div class="auth-header">
                <h2>Admin Login</h2>
                <p>Administrator Access Only</p>
            </div>

            <div class="form-group">
                <label class="form-label">Admin Name</label>
                <input type="text" class="form-input" id="adminName" placeholder="Enter admin name">
            </div>

            <div class="form-group">
                <label class="form-label">Password</label>
                <input type="password" class="form-input" id="adminPassword" placeholder="Enter admin password">
            </div>

            <button class="btn btn-primary btn-block" onclick="loginAdmin()">
                <i class="fas fa-sign-in-alt"></i> Login as Admin
            </button>

            <button class="btn btn-secondary btn-block" onclick="backToWelcome()">
                <i class="fas fa-arrow-left"></i> Back to Home
            </button>
        </div>
    </div>

    <!-- Customer Dashboard -->
    <div class="dashboard" id="customerDashboard">
        <header class="header">
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-motorcycle logo-icon"></i>
                    <span>THE LAND RIDERS</span>
                </div>
                
                <div class="header-actions">
                    <div class="notification-badge" onclick="showNotifications()">
                        <i class="fas fa-bell"></i>
                        <span class="badge" id="notificationCount">0</span>
                    </div>
                    <div class="user-info">
                        <div class="user-avatar" id="customerAvatar">C</div>
                        <div>
                            <div id="customerWelcome">Welcome</div>
                            <div style="font-size: 12px; color: var(--gray);">Customer</div>
                        </div>
                    </div>
                    <button class="btn btn-danger" onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </button>
                </div>
            </div>
        </header>

        <div class="main-content">
            <div class="booking-panel">
                <!-- Location Selection -->
                <div class="booking-section">
                    <h3><i class="fas fa-map-marker-alt"></i> Plan Your Ride</h3>
                    
                    <div class="location-inputs">
                        <div class="location-input">
                            <i class="fas fa-location-arrow"></i>
                            <input type="text" id="pickupLocation" placeholder="Your current location" readonly>
                        </div>
                        <div class="location-input">
                            <i class="fas fa-flag-checkered"></i>
                            <input type="text" id="destinationLocation" placeholder="Where to?">
                        </div>
                        
                        <div class="location-actions">
                            <button class="btn btn-success" onclick="useCurrentLocation()">
                                <i class="fas fa-location-crosshairs"></i> Current Location
                            </button>
                            <button class="btn btn-secondary" onclick="openMapForPickup()">
                                <i class="fas fa-map"></i> Choose on Map
                            </button>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Vehicle Type</label>
                        <div class="vehicle-selection">
                            <div class="vehicle-option active" onclick="selectVehicle('bike')">
                                <i class="fas fa-motorcycle"></i>
                                <div class="vehicle-name">Bike</div>
                                <div class="vehicle-price">Starting from Rs 100</div>
                            </div>
                            <div class="vehicle-option" onclick="selectVehicle('car')">
                                <i class="fas fa-car"></i>
                                <div class="vehicle-name">Car</div>
                                <div class="vehicle-price">Starting from Rs 300</div>
                            </div>
                        </div>
                    </div>

                    <button class="btn btn-primary btn-block" onclick="searchRiders()" id="searchRidersBtn">
                        <i class="fas fa-search"></i> Find Available Riders
                    </button>
                </div>

                <!-- Active Ride -->
                <div id="activeRideSection" style="display: none;">
                    <div class="active-ride-card">
                        <h3 style="color: white; margin-bottom: 20px;">
                            <i class="fas fa-biking"></i> Ride in Progress
                        </h3>
                        
                        <div class="ride-info-grid" id="activeRideDetails">
                            <!-- Active ride details -->
                        </div>
                        
                        <div class="offer-actions">
                            <button class="btn btn-danger" onclick="cancelRide('customer')">
                                <i class="fas fa-times"></i> Cancel Ride
                            </button>
                            <button class="btn btn-success" onclick="completeRide()">
                                <i class="fas fa-check"></i> Ride Completed
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Available Offers -->
                <div class="booking-section" id="offersSection" style="display: none;">
                    <h3><i class="fas fa-tags"></i> Available Offers</h3>
                    <p style="color: var(--gray); margin-bottom: 20px;">
                        Select an offer from available riders
                    </p>
                    
                    <div class="offers-container" id="offersContainer">
                        <!-- Offers will be dynamically added here -->
                    </div>
                    
                    <button class="btn btn-danger btn-block" onclick="cancelSearch()" style="margin-top: 20px;">
                        <i class="fas fa-times"></i> Cancel Search
                    </button>
                </div>

                <!-- Complain Section -->
                <div class="booking-section">
                    <h3><i class="fas fa-comment-alt"></i> Submit Feedback</h3>
                    <p style="color: var(--gray); margin-bottom: 15px;">
                        Rate your experience or submit a complaint
                    </p>
                    
                    <button class="btn btn-warning btn-block" onclick="openComplainModal()">
                        <i class="fas fa-exclamation-triangle"></i> Submit Complain
                    </button>
                </div>
            </div>

            <div class="map-container">
                <div id="map"></div>
            </div>
        </div>
    </div>

    <!-- Rider Dashboard -->
    <div class="dashboard rider-dashboard" id="riderDashboard">
        <header class="header">
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-motorcycle logo-icon"></i>
                    <span>THE LAND RIDERS</span>
                </div>
                
                <div class="header-actions">
                    <div class="notification-badge" onclick="showNotifications()">
                        <i class="fas fa-bell"></i>
                        <span class="badge" id="riderNotificationCount">0</span>
                    </div>
                    <div class="user-info">
                        <div class="user-avatar" id="riderAvatar">R</div>
                        <div>
                            <div id="riderWelcome">Rider</div>
                            <div style="font-size: 12px; color: var(--gray);" id="riderStatusText">Offline</div>
                        </div>
                    </div>
                    <button class="btn btn-danger" onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </button>
                </div>
            </div>
        </header>

        <div class="main-content">
            <div class="rider-panel">
                <!-- Status Card -->
                <div class="status-card">
                    <h3 style="color: white; margin-bottom: 20px;">
                        <i class="fas fa-user-circle"></i> Rider Control Panel
                    </h3>
                    
                    <div class="status-toggle">
                        <span style="font-weight: 600;">Go Online</span>
                        <label class="toggle-switch">
                            <input type="checkbox" id="riderStatusToggle" onchange="toggleRiderStatus()">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    
                    <div class="status-indicator" id="riderStatusIndicator">
                        <i class="fas fa-circle"></i>
                        <span id="statusText">Offline</span>
                    </div>
                </div>

                <!-- Live Location Section -->
                <div class="live-location-section">
                    <h4><i class="fas fa-map-marker-alt"></i> Live Location Sharing</h4>
                    <p style="color: var(--gray); margin-bottom: 15px; font-size: 14px;">
                        Share your live location to appear on customer maps
                    </p>
                    
                    <div class="location-share">
                        <input type="text" id="liveLocationInput" placeholder="Paste Google Maps share link">
                        <button class="btn btn-success" onclick="shareLiveLocation()">
                            <i class="fas fa-share-alt"></i> Share
                        </button>
                    </div>
                    
                    <div class="share-duration">
                        <button class="duration-btn active" onclick="setShareDuration(1)">1 Hour</button>
                        <button class="duration-btn" onclick="setShareDuration(4)">4 Hours</button>
                        <button class="duration-btn" onclick="setShareDuration(8)">8 Hours</button>
                        <button class="duration-btn" onclick="setShareDuration(24)">24 Hours</button>
                    </div>
                    
                    <p style="color: var(--success); font-size: 13px; margin-top: 10px; display: none;" id="locationShareStatus">
                        <i class="fas fa-check-circle"></i> Location shared successfully
                    </p>
                </div>

                <!-- Active Ride -->
                <div id="riderActiveRideSection" style="display: none;">
                    <div class="active-ride-card">
                        <h3 style="color: white; margin-bottom: 20px;">
                            <i class="fas fa-biking"></i> Active Ride
                        </h3>
                        
                        <div class="ride-info-grid" id="riderActiveRideDetails">
                            <!-- Active ride details -->
                        </div>
                        
                        <div class="offer-actions">
                            <button class="btn btn-danger" onclick="cancelRide('rider')">
                                <i class="fas fa-times"></i> Cancel Ride
                            </button>
                            <button class="btn btn-success" onclick="completeRide()">
                                <i class="fas fa-check"></i> Ride Completed
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Ride Requests -->
                <div class="booking-section">
                    <h3><i class="fas fa-bell"></i> New Ride Requests</h3>
                    <div class="requests-container" id="requestsContainer">
                        <!-- Ride requests will be added here -->
                    </div>
                </div>
            </div>

            <div class="map-container">
                <div id="riderMap"></div>
            </div>
        </div>
    </div>

    <!-- Admin Dashboard -->
    <div class="dashboard admin-dashboard" id="adminDashboard">
        <header class="header">
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-motorcycle logo-icon"></i>
                    <span>THE LAND RIDERS</span>
                </div>
                
                <div class="header-actions">
                    <div class="user-info">
                        <div class="user-avatar" id="adminAvatar">A</div>
                        <div>
                            <div id="adminWelcome">Administrator</div>
                            <div style="font-size: 12px; color: var(--gray);">Admin Panel</div>
                        </div>
                    </div>
                    <button class="btn btn-danger" onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </button>
                </div>
            </div>
        </header>

        <div class="admin-content">
            <!-- Statistics -->
            <div class="admin-stats">
                <div class="stat-card">
                    <div class="stat-value" id="totalCustomers">0</div>
                    <div class="stat-label">Total Customers</div>
                    <span class="stat-change positive" id="customerChange">+0 Today</span>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="totalRides">0</div>
                    <div class="stat-label">Total Rides</div>
                    <span class="stat-change positive" id="rideChange">+0 Today</span>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="activeRiders">0</div>
                    <div class="stat-label">Active Riders</div>
                    <span class="stat-change" id="riderChange">0 Online</span>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="totalEarnings">Rs 0</div>
                    <div class="stat-label">Total Earnings</div>
                    <span class="stat-change positive" id="earningChange">+Rs 0 Today</span>
                </div>
            </div>

            <!-- Rider Management -->
            <div class="admin-section">
                <h3><i class="fas fa-users"></i> Rider Management</h3>
                <button class="btn btn-primary" onclick="openAddRiderModal()">
                    <i class="fas fa-user-plus"></i> Add New Rider
                </button>
                
                <table class="admin-table">
                    <thead>
                        <tr>
                            <th>Rider ID</th>
                            <th>Name</th>
                            <th>Phone</th>
                            <th>Status</th>
                            <th>Vehicle</th>
                            <th>Rating</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="riderTable">
                        <!-- Riders will be added here -->
                    </tbody>
                </table>
            </div>

            <!-- Recent Rides -->
            <div class="admin-section">
                <h3><i class="fas fa-history"></i> Recent Rides</h3>
                <table class="admin-table">
                    <thead>
                        <tr>
                            <th>Ride ID</th>
                            <th>Customer</th>
                            <th>Rider</th>
                            <th>From  To</th>
                            <th>Fare</th>
                            <th>Status</th>
                            <th>Time</th>
                        </tr>
                    </thead>
                    <tbody id="ridesTable">
                        <!-- Rides will be added here -->
                    </tbody>
                </table>
            </div>

            <!-- Complaints -->
            <div class="admin-section">
                <h3><i class="fas fa-exclamation-triangle"></i> Customer Complaints</h3>
                <table class="admin-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Customer</th>
                            <th>Rider</th>
                            <th>Complaint</th>
                            <th>Rating</th>
                            <th>Status</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody id="complaintsTable">
                        <!-- Complaints will be added here -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div class="modal" id="loadingOverlay">
        <div class="modal-content" style="max-width: 300px; background: transparent; box-shadow: none;">
            <div style="text-align: center;">
                <div class="loading-spinner"></div>
                <p style="color: white; margin-top: 20px; font-size: 16px;" id="loadingText">Loading...</p>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div class="toast" id="toast">
        <i class="fas fa-info-circle"></i>
        <span id="toastMessage">Notification</span>
    </div>

    <!-- Complain Modal -->
    <div class="modal" id="complainModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-exclamation-triangle"></i> Submit Complaint</h3>
                <button onclick="closeModal('complainModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Your Email</label>
                    <input type="email" class="form-input" id="complainEmail" placeholder="Enter your email for follow-up">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Select Rider</label>
                    <select class="form-input" id="complainRider">
                        <option value="">Select a rider</option>
                        <!-- Riders will be populated -->
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Rate your experience</label>
                    <div class="rating-input">
                        <i class="fas fa-star rating-star" data-rating="1"></i>
                        <i class="fas fa-star rating-star" data-rating="2"></i>
                        <i class="fas fa-star rating-star" data-rating="3"></i>
                        <i class="fas fa-star rating-star" data-rating="4"></i>
                        <i class="fas fa-star rating-star" data-rating="5"></i>
                    </div>
                    <input type="hidden" id="complainRating" value="0">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Complaint Details</label>
                    <textarea class="form-input" id="complainDetails" 
                              placeholder="Describe your complaint in detail..." 
                              rows="4"></textarea>
                </div>
                
                <button class="btn btn-warning btn-block" onclick="submitComplaint()">
                    <i class="fas fa-paper-plane"></i> Submit Complaint
                </button>
            </div>
        </div>
    </div>

    <!-- Add Rider Modal (Admin) -->
    <div class="modal" id="addRiderModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-user-plus"></i> Add New Rider</h3>
                <button onclick="closeModal('addRiderModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Rider Name</label>
                    <input type="text" class="form-input" id="newRiderName" placeholder="Enter rider's full name">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Phone Number</label>
                    <input type="tel" class="form-input" id="newRiderPhone" placeholder="+92 300 1234567">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Vehicle Type</label>
                    <select class="form-input" id="newRiderVehicle">
                        <option value="bike">Bike</option>
                        <option value="car">Car</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Vehicle Number</label>
                    <input type="text" class="form-input" id="newRiderVehicleNo" placeholder="AB-123">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Generate Rider ID</label>
                    <div style="display: flex; gap: 10px;">
                        <input type="text" class="form-input" id="newRiderId" placeholder="Auto-generate" readonly>
                        <button class="btn btn-secondary" onclick="generateRiderId()">
                            <i class="fas fa-sync-alt"></i> Generate
                        </button>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Set Password</label>
                    <input type="password" class="form-input" id="newRiderPassword" placeholder="Set login password">
                </div>
                
                <button class="btn btn-primary btn-block" onclick="addNewRider()">
                    <i class="fas fa-save"></i> Save Rider
                </button>
            </div>
        </div>
    </div>

    <!-- Notification Modal -->
    <div class="modal" id="notificationModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-bell"></i> Notifications</h3>
                <button onclick="closeModal('notificationModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div id="notificationList">
                    <!-- Notifications will be added here -->
                </div>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // Application State
        const APP_STATE = {
            // User management
            currentUser: null,
            userRole: null,
            
            // Data storage
            customers: JSON.parse(localStorage.getItem('landRiders_customers')) || [],
            riders: JSON.parse(localStorage.getItem('landRiders_riders')) || [],
            rides: JSON.parse(localStorage.getItem('landRiders_rides')) || [],
            complaints: JSON.parse(localStorage.getItem('landRiders_complaints')) || [],
            notifications: JSON.parse(localStorage.getItem('landRiders_notifications')) || [],
            
            // Current session
            currentRide: null,
            selectedVehicle: 'bike',
            availableRiders: [],
            rideOffers: [],
            currentLocation: null,
            destination: null,
            map: null,
            riderMap: null,
            markers: [],
            riderMarkers: [],
            liveLocationInterval: null
        };

        // Initialize the application
        function initApp() {
            // Hide loading screen after 2 seconds
            setTimeout(() => {
                document.querySelector('.loading-screen').style.opacity = '0';
                setTimeout(() => {
                    document.querySelector('.loading-screen').style.display = 'none';
                    showWelcomeScreen();
                }, 500);
            }, 2000);

            // Initialize sample data if empty
            if (APP_STATE.riders.length === 0) {
                initializeSampleRiders();
            }
            
            if (APP_STATE.customers.length === 0) {
                initializeSampleCustomers();
            }
            
            if (localStorage.getItem('landRiders_admin') === null) {
                initializeAdmin();
            }
        }

        // Sample data initialization
        function initializeSampleRiders() {
            const sampleRiders = [
                {
                    id: "12345",
                    name: "Ahmed Khan",
                    phone: "+92 300 1112233",
                    password: "ahmed123",
                    status: "online",
                    rating: 4.8,
                    totalRides: 145,
                    vehicleType: "bike",
                    vehicleNumber: "MZ-123",
                    location: { lat: 34.368, lng: 73.471 },
                    liveLocation: null,
                    earnings: 45000,
                    joinedDate: "2023-01-15"
                },
                {
                    id: "54321",
                    name: "Usman Ali",
                    phone: "+92 300 2223344",
                    password: "usman123",
                    status: "online",
                    rating: 4.5,
                    totalRides: 98,
                    vehicleType: "car",
                    vehicleNumber: "MZ-456",
                    location: { lat: 34.372, lng: 73.475 },
                    liveLocation: null,
                    earnings: 32000,
                    joinedDate: "2023-03-20"
                }
            ];
            
            APP_STATE.riders = sampleRiders;
            saveData('riders');
        }

        function initializeSampleCustomers() {
            const sampleCustomers = [
                {
                    phone: "+92 300 3334455",
                    name: "Ali Raza",
                    email: "ali@example.com",
                    password: "ali123",
                    totalRides: 12,
                    joinedDate: "2023-05-10"
                }
            ];
            
            APP_STATE.customers = sampleCustomers;
            saveData('customers');
        }

        function initializeAdmin() {
            const adminData = {
                name: "safeer",
                password: "safeer786",
                admins: ["safeer"]
            };
            
            localStorage.setItem('landRiders_admin', JSON.stringify(adminData));
        }

        // Save data to localStorage
        function saveData(type) {
            switch(type) {
                case 'customers':
                    localStorage.setItem('landRiders_customers', JSON.stringify(APP_STATE.customers));
                    break;
                case 'riders':
                    localStorage.setItem('landRiders_riders', JSON.stringify(APP_STATE.riders));
                    break;
                case 'rides':
                    localStorage.setItem('landRiders_rides', JSON.stringify(APP_STATE.rides));
                    break;
                case 'complaints':
                    localStorage.setItem('landRiders_complaints', JSON.stringify(APP_STATE.complaints));
                    break;
                case 'notifications':
                    localStorage.setItem('landRiders_notifications', JSON.stringify(APP_STATE.notifications));
                    break;
            }
        }

        // UI Navigation Functions
        function showWelcomeScreen() {
            hideAllScreens();
            document.getElementById('welcomeScreen').style.display = 'flex';
        }

        function showAuth(type) {
            hideAllScreens();
            document.getElementById(type + 'Auth').style.display = 'flex';
            
            // For rider auth, show the WhatsApp contact section
            if (type === 'rider') {
                // Already handled in HTML
            }
        }

        function showLogin(type) {
            hideAllScreens();
            document.getElementById(type + 'Login').style.display = 'flex';
        }

        function showRegistration(type) {
            hideAllScreens();
            document.getElementById(type + 'Auth').style.display = 'flex';
        }

        function showRiderLogin() {
            hideAllScreens();
            document.getElementById('riderLogin').style.display = 'flex';
        }

        function showRiderRegistration() {
            hideAllScreens();
            document.getElementById('riderAuth').style.display = 'flex';
        }

        function backToWelcome() {
            showWelcomeScreen();
        }

        function hideAllScreens() {
            const screens = ['welcomeScreen', 'customerAuth', 'customerLogin', 
                           'riderAuth', 'riderLogin', 'adminAuth', 'customerDashboard',
                           'riderDashboard', 'adminDashboard'];
            screens.forEach(screen => {
                document.getElementById(screen).style.display = 'none';
            });
        }

        // Form Step Navigation
        let currentStep = 1;
        
        function nextStep(type, step) {
            const currentStepEl = document.getElementById(type + 'Step' + currentStep);
            const nextStepEl = document.getElementById(type + 'Step' + step);
            
            if (!validateStep(type, currentStep)) {
                return;
            }
            
            // Update step indicators
            document.getElementById('step' + currentStep).classList.remove('active');
            document.getElementById('step' + step).classList.add('active');
            
            // Switch steps
            currentStepEl.classList.remove('active');
            nextStepEl.classList.add('active');
            
            currentStep = step;
        }

        function validateStep(type, step) {
            switch(step) {
                case 1:
                    const phone = document.getElementById('customerPhone').value;
                    if (!phone || phone.length < 10) {
                        showError('customerPhoneError', 'Please enter a valid phone number');
                        return false;
                    }
                    return true;
                    
                case 2:
                    const name = document.getElementById('customerName').value;
                    if (!name || name.length < 3) {
                        showError('customerNameError', 'Please enter your full name');
                        return false;
                    }
                    return true;
                    
                case 3:
                    const password = document.getElementById('customerPassword').value;
                    const confirmPassword = document.getElementById('customerConfirmPassword').value;
                    
                    if (!password || password.length < 6) {
                        showError('customerPasswordError', 'Password must be at least 6 characters');
                        return false;
                    }
                    
                    if (password !== confirmPassword) {
                        showError('customerPasswordError', 'Passwords do not match');
                        return false;
                    }
                    return true;
            }
            return true;
        }

        // Customer Registration
        function registerCustomer() {
            const phone = document.getElementById('customerPhone').value;
            const name = document.getElementById('customerName').value;
            const email = document.getElementById('customerEmail').value;
            const password = document.getElementById('customerPassword').value;
            
            // Check if customer already exists
            const existingCustomer = APP_STATE.customers.find(c => c.phone === phone);
            if (existingCustomer) {
                showToast('Phone number already registered', 'error');
                return;
            }
            
            // Create new customer
            const newCustomer = {
                phone,
                name,
                email: email || '',
                password,
                totalRides: 0,
                joinedDate: new Date().toISOString().split('T')[0]
            };
            
            APP_STATE.customers.push(newCustomer);
            saveData('customers');
            
            // Auto login
            APP_STATE.currentUser = newCustomer;
            APP_STATE.userRole = 'customer';
            
            showToast('Registration successful!', 'success');
            showCustomerDashboard();
            
            // Request location permission
            requestLocationPermission();
        }

        // Customer Login
        function loginCustomer() {
            const phone = document.getElementById('loginCustomerPhone').value;
            const password = document.getElementById('loginCustomerPassword').value;
            
            const customer = APP_STATE.customers.find(c => c.phone === phone && c.password === password);
            
            if (customer) {
                APP_STATE.currentUser = customer;
                APP_STATE.userRole = 'customer';
                
                showToast('Login successful!', 'success');
                showCustomerDashboard();
                
                // Request location permission
                requestLocationPermission();
            } else {
                showToast('Invalid phone number or password', 'error');
            }
        }

        // Rider Login
        function loginRider() {
            const riderId = document.getElementById('riderId').value;
            const password = document.getElementById('riderPassword').value;
            
            const rider = APP_STATE.riders.find(r => r.id === riderId && r.password === password);
            
            if (rider) {
                APP_STATE.currentUser = rider;
                APP_STATE.userRole = 'rider';
                
                showToast('Welcome back, ' + rider.name + '!', 'success');
                showRiderDashboard();
            } else {
                showToast('Invalid Rider ID or password', 'error');
            }
        }

        // Admin Login
        function loginAdmin() {
            const name = document.getElementById('adminName').value;
            const password = document.getElementById('adminPassword').value;
            
            const adminData = JSON.parse(localStorage.getItem('landRiders_admin'));
            
            if (name === adminData.name && password === adminData.password) {
                APP_STATE.currentUser = { name: 'Administrator' };
                APP_STATE.userRole = 'admin';
                
                showToast('Admin login successful!', 'success');
                showAdminDashboard();
            } else {
                showToast('Invalid admin credentials', 'error');
            }
        }

        // Dashboard Functions
        function showCustomerDashboard() {
            hideAllScreens();
            document.getElementById('customerDashboard').style.display = 'block';
            
            // Update welcome message
            document.getElementById('customerWelcome').textContent = 'Hello, ' + APP_STATE.currentUser.name;
            document.getElementById('customerAvatar').textContent = APP_STATE.currentUser.name.charAt(0);
            
            // Initialize map
            initCustomerMap();
            
            // Load notifications
            updateNotificationCount();
        }

        function showRiderDashboard() {
            hideAllScreens();
            document.getElementById('riderDashboard').style.display = 'block';
            
            // Update rider info
            document.getElementById('riderWelcome').textContent = APP_STATE.currentUser.name;
            document.getElementById('riderAvatar').textContent = APP_STATE.currentUser.name.charAt(0);
            
            // Set initial status
            updateRiderStatusUI();
            
            // Initialize rider map
            initRiderMap();
            
            // Load notifications
            updateNotificationCount();
            
            // Load ride requests
            loadRideRequests();
        }

        function showAdminDashboard() {
            hideAllScreens();
            document.getElementById('adminDashboard').style.display = 'block';
            
            // Update admin info
            document.getElementById('adminWelcome').textContent = APP_STATE.currentUser.name;
            document.getElementById('adminAvatar').textContent = APP_STATE.currentUser.name.charAt(0);
            
            // Load statistics
            loadAdminStats();
            
            // Load riders table
            loadRidersTable();
            
            // Load rides table
            loadRidesTable();
            
            // Load complaints table
            loadComplaintsTable();
        }

        // Location Functions
        function requestLocationPermission() {
            if (navigator.geolocation) {
                showLoading('Getting your location...');
                
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        APP_STATE.currentLocation = {
                            lat: position.coords.latitude,
                            lng: position.coords.longitude
                        };
                        
                        document.getElementById('pickupLocation').value = "Your Current Location";
                        showToast('Location detected successfully', 'success');
                        hideLoading();
                        
                        // Update map
                        if (APP_STATE.map) {
                            APP_STATE.map.setView([APP_STATE.currentLocation.lat, APP_STATE.currentLocation.lng], 15);
                            
                            // Add marker
                            L.marker([APP_STATE.currentLocation.lat, APP_STATE.currentLocation.lng])
                                .addTo(APP_STATE.map)
                                .bindPopup('Your Location')
                                .openPopup();
                        }
                    },
                    (error) => {
                        console.error('Geolocation error:', error);
                        showToast('Please enable location services', 'warning');
                        hideLoading();
                        
                        // Default to Muzaffarabad center
                        APP_STATE.currentLocation = { lat: 34.368, lng: 73.471 };
                        document.getElementById('pickupLocation').value = "Muzaffarabad Center";
                    },
                    { enableHighAccuracy: true, timeout: 10000 }
                );
            } else {
                showToast('Geolocation not supported', 'error');
                APP_STATE.currentLocation = { lat: 34.368, lng: 73.471 };
            }
        }

        function useCurrentLocation() {
            if (!APP_STATE.currentLocation) {
                requestLocationPermission();
            } else {
                document.getElementById('pickupLocation').value = "Your Current Location";
                showToast('Using your current location', 'success');
            }
        }

        function openMapForPickup() {
            showToast('Map selection would open here', 'info');
        }

        // Map Functions
        function initCustomerMap() {
            if (APP_STATE.map) {
                APP_STATE.map.remove();
            }
            
            // Center on Muzaffarabad
            APP_STATE.map = L.map('map').setView([34.368, 73.471], 14);
            
            // Add tile layer
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: ' OpenStreetMap contributors'
            }).addTo(APP_STATE.map);
            
            // Add markers for online riders
            updateRiderMarkers();
        }

        function initRiderMap() {
            if (APP_STATE.riderMap) {
                APP_STATE.riderMap.remove();
            }
            
            APP_STATE.riderMap = L.map('riderMap').setView([34.368, 73.471], 14);
            
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: ' OpenStreetMap contributors'
            }).addTo(APP_STATE.riderMap);
        }

        function updateRiderMarkers() {
            // Clear existing markers
            APP_STATE.markers.forEach(marker => marker.remove());
            APP_STATE.markers = [];
            
            // Add markers for online riders with live location
            APP_STATE.riders
                .filter(rider => rider.status === 'online' && rider.liveLocation)
                .forEach(rider => {
                    const marker = L.marker([rider.location.lat, rider.location.lng])
                        .addTo(APP_STATE.map)
                        .bindPopup(`
                            <b>${rider.name}</b><br>
                            Rating: ${rider.rating} <br>
                            Vehicle: ${rider.vehicleNumber}<br>
                            ${rider.vehicleType === 'car' ? 'Car' : 'Bike'}
                        `);
                    
                    APP_STATE.markers.push(marker);
                });
        }

        // Vehicle Selection
        function selectVehicle(type) {
            APP_STATE.selectedVehicle = type;
            
            // Update UI
            document.querySelectorAll('.vehicle-option').forEach(option => {
                option.classList.remove('active');
            });
            event.target.closest('.vehicle-option').classList.add('active');
        }

        // Search Riders
        function searchRiders() {
            const destination = document.getElementById('destinationLocation').value;
            
            if (!destination) {
                showToast('Please enter destination', 'error');
                return;
            }
            
            if (!APP_STATE.currentLocation) {
                showToast('Please enable location services', 'error');
                return;
            }
            
            showLoading('Searching for available riders...');
            
            // Simulate API call
            setTimeout(() => {
                // Find available riders
                APP_STATE.availableRiders = APP_STATE.riders.filter(rider => 
                    rider.status === 'online' && 
                    rider.vehicleType === APP_STATE.selectedVehicle
                );
                
                if (APP_STATE.availableRiders.length === 0) {
                    showToast('No riders available at the moment', 'warning');
                    hideLoading();
                    return;
                }
                
                // Create ride request
                const rideRequest = {
                    id: Date.now(),
                    customer: APP_STATE.currentUser,
                    pickup: APP_STATE.currentLocation,
                    destination: destination,
                    vehicleType: APP_STATE.selectedVehicle,
                    status: 'pending',
                    timestamp: new Date().toISOString()
                };
                
                // Send notifications to riders
                sendRideRequestToRiders(rideRequest);
                
                // Show offers section
                document.getElementById('offersSection').style.display = 'block';
                document.getElementById('offersContainer').innerHTML = '';
                
                showToast(`${APP_STATE.availableRiders.length} riders notified`, 'success');
                hideLoading();
            }, 1500);
        }

        function sendRideRequestToRiders(rideRequest) {
            APP_STATE.availableRiders.forEach(rider => {
                // Create notification
                const notification = {
                    id: Date.now() + Math.random(),
                    type: 'ride_request',
                    riderId: rider.id,
                    message: `New ride request from ${rideRequest.customer.name}`,
                    data: rideRequest,
                    timestamp: new Date().toISOString(),
                    read: false
                };
                
                APP_STATE.notifications.push(notification);
            });
            
            saveData('notifications');
            updateNotificationCount();
        }

        // Rider Status Management
        function toggleRiderStatus() {
            const toggle = document.getElementById('riderStatusToggle');
            const rider = APP_STATE.currentUser;
            
            if (toggle.checked) {
                rider.status = 'online';
                showToast('You are now online', 'success');
                
                // Check if live location is set
                if (!rider.liveLocation) {
                    showToast('Please share your live location', 'warning');
                }
            } else {
                rider.status = 'offline';
                rider.liveLocation = null;
                showToast('You are now offline', 'warning');
                
                // Clear live location interval
                if (APP_STATE.liveLocationInterval) {
                    clearInterval(APP_STATE.liveLocationInterval);
                    APP_STATE.liveLocationInterval = null;
                }
            }
            
            // Update in riders array
            const riderIndex = APP_STATE.riders.findIndex(r => r.id === rider.id);
            if (riderIndex !== -1) {
                APP_STATE.riders[riderIndex] = rider;
                saveData('riders');
            }
            
            updateRiderStatusUI();
            updateRiderMarkers();
        }

        function updateRiderStatusUI() {
            const rider = APP_STATE.currentUser;
            const statusText = document.getElementById('statusText');
            const riderStatusText = document.getElementById('riderStatusText');
            const toggle = document.getElementById('riderStatusToggle');
            const indicator = document.getElementById('riderStatusIndicator');
            
            if (rider.status === 'online') {
                statusText.textContent = 'Online';
                riderStatusText.textContent = 'Online';
                toggle.checked = true;
                indicator.style.background = 'rgba(76, 175, 80, 0.2)';
                indicator.innerHTML = '<i class="fas fa-circle" style="color: #4CAF50;"></i> Online';
            } else {
                statusText.textContent = 'Offline';
                riderStatusText.textContent = 'Offline';
                toggle.checked = false;
                indicator.style.background = 'rgba(117, 117, 117, 0.2)';
                indicator.innerHTML = '<i class="fas fa-circle" style="color: #757575;"></i> Offline';
            }
        }

        // Live Location Sharing
        function shareLiveLocation() {
            const locationInput = document.getElementById('liveLocationInput').value;
            
            if (!locationInput) {
                showToast('Please enter a location share link', 'error');
                return;
            }
            
            // Parse location from Google Maps share link (simplified)
            const location = parseLocationFromShareLink(locationInput);
            
            if (!location) {
                showToast('Invalid location link', 'error');
                return;
            }
            
            const rider = APP_STATE.currentUser;
            rider.liveLocation = locationInput;
            rider.location = location;
            
            // Update in riders array
            const riderIndex = APP_STATE.riders.findIndex(r => r.id === rider.id);
            if (riderIndex !== -1) {
                APP_STATE.riders[riderIndex] = rider;
                saveData('riders');
            }
            
            // Show success
            document.getElementById('locationShareStatus').style.display = 'block';
            showToast('Live location shared successfully', 'success');
            
            // Update rider status to online if not already
            if (rider.status !== 'online') {
                rider.status = 'online';
                document.getElementById('riderStatusToggle').checked = true;
                updateRiderStatusUI();
            }
            
            // Update map
            updateRiderMarkers();
            
            // Simulate location updates every 30 seconds
            if (APP_STATE.liveLocationInterval) {
                clearInterval(APP_STATE.liveLocationInterval);
            }
            
            APP_STATE.liveLocationInterval = setInterval(() => {
                // Simulate small location changes
                rider.location.lat += (Math.random() - 0.5) * 0.001;
                rider.location.lng += (Math.random() - 0.5) * 0.001;
                
                const riderIndex = APP_STATE.riders.findIndex(r => r.id === rider.id);
                if (riderIndex !== -1) {
                    APP_STATE.riders[riderIndex] = rider;
                    saveData('riders');
                }
                
                updateRiderMarkers();
            }, 30000);
        }

        function parseLocationFromShareLink(link) {
            // Simplified parsing - in real app, use proper URL parsing
            // For demo, return random location near Muzaffarabad
            return {
                lat: 34.368 + (Math.random() - 0.5) * 0.02,
                lng: 73.471 + (Math.random() - 0.5) * 0.02
            };
        }

        function setShareDuration(hours) {
            // Update UI
            document.querySelectorAll('.duration-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            showToast(`Location will be shared for ${hours} hours`, 'info');
        }

        // Load Ride Requests for Rider
        function loadRideRequests() {
            const container = document.getElementById('requestsContainer');
            container.innerHTML = '';
            
            const riderNotifications = APP_STATE.notifications.filter(
                n => n.type === 'ride_request' && n.riderId === APP_STATE.currentUser.id && !n.read
            );
            
            if (riderNotifications.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: var(--gray); padding: 20px;">No new ride requests</p>';
                return;
            }
            
            riderNotifications.forEach(notification => {
                const request = notification.data;
                const requestCard = createRideRequestCard(request, notification.id);
                container.appendChild(requestCard);
            });
        }

        function createRideRequestCard(request, notificationId) {
            const div = document.createElement('div');
            div.className = 'request-card';
            div.innerHTML = `
                <div class="request-header">
                    <div class="customer-info">
                        <div class="customer-avatar">${request.customer.name.charAt(0)}</div>
                        <div>
                            <h4>${request.customer.name}</h4>
                            <div style="font-size: 12px; color: var(--gray);">${request.customer.phone}</div>
                        </div>
                    </div>
                    <div class="offer-price">Rs ${request.vehicleType === 'car' ? '300' : '100'}+</div>
                </div>
                
                <div class="request-details">
                    <p><i class="fas fa-map-marker-alt"></i> Pickup: Customer Location</p>
                    <p><i class="fas fa-flag-checkered"></i> Destination: ${request.destination}</p>
                    <p><i class="fas fa-motorcycle"></i> Vehicle: ${request.vehicleType === 'car' ? 'Car' : 'Bike'}</p>
                </div>
                
                <div class="offer-form" style="margin-top: 15px;">
                    <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                        <input type="number" class="form-input" placeholder="Your offer (Rs)" 
                               id="offerAmount_${notificationId}" 
                               value="${request.vehicleType === 'car' ? '300' : '100'}">
                        <input type="number" class="form-input" placeholder="ETA (minutes)" 
                               id="eta_${notificationId}" value="15">
                    </div>
                    <div class="offer-actions">
                        <button class="btn btn-success" onclick="sendOffer('${notificationId}')">
                            <i class="fas fa-paper-plane"></i> Send Offer
                        </button>
                        <button class="btn btn-secondary" onclick="declineRequest('${notificationId}')">
                            <i class="fas fa-times"></i> Decline
                        </button>
                    </div>
                </div>
            `;
            return div;
        }

        function sendOffer(notificationId) {
            const offerAmount = document.getElementById(`offerAmount_${notificationId}`).value;
            const eta = document.getElementById(`eta_${notificationId}`).value;
            
            if (!offerAmount || !eta) {
                showToast('Please enter offer amount and ETA', 'error');
                return;
            }
            
            const notification = APP_STATE.notifications.find(n => n.id == notificationId);
            if (!notification) return;
            
            const request = notification.data;
            const rider = APP_STATE.currentUser;
            
            // Create ride offer
            const rideOffer = {
                id: Date.now(),
                requestId: request.id,
                customer: request.customer,
                rider: rider,
                pickup: request.pickup,
                destination: request.destination,
                vehicleType: request.vehicleType,
                offerAmount: parseInt(offerAmount),
                eta: parseInt(eta),
                status: 'offer_sent',
                timestamp: new Date().toISOString()
            };
            
            // Add to rides array
            APP_STATE.rides.push(rideOffer);
            saveData('rides');
            
            // Mark notification as read
            notification.read = true;
            saveData('notifications');
            
            // Send notification to customer
            const customerNotification = {
                id: Date.now(),
                type: 'ride_offer',
                customerPhone: request.customer.phone,
                message: `New offer from ${rider.name} for Rs ${offerAmount}`,
                data: rideOffer,
                timestamp: new Date().toISOString(),
                read: false
            };
            
            APP_STATE.notifications.push(customerNotification);
            saveData('notifications');
            
            showToast('Offer sent to customer', 'success');
            
            // Reload requests
            loadRideRequests();
            updateNotificationCount();
        }

        function declineRequest(notificationId) {
            const notification = APP_STATE.notifications.find(n => n.id == notificationId);
            if (notification) {
                notification.read = true;
                saveData('notifications');
                
                showToast('Request declined', 'warning');
                loadRideRequests();
                updateNotificationCount();
            }
        }

        // Admin Functions
        function loadAdminStats() {
            // Calculate statistics
            const totalCustomers = APP_STATE.customers.length;
            const totalRides = APP_STATE.rides.length;
            const activeRiders = APP_STATE.riders.filter(r => r.status === 'online').length;
            const totalEarnings = APP_STATE.rides
                .filter(r => r.status === 'completed')
                .reduce((sum, ride) => sum + (ride.offerAmount || 0), 0);
            
            // Today's data
            const today = new Date().toISOString().split('T')[0];
            const todayRides = APP_STATE.rides.filter(r => r.timestamp.split('T')[0] === today).length;
            const todayEarnings = APP_STATE.rides
                .filter(r => r.timestamp.split('T')[0] === today && r.status === 'completed')
                .reduce((sum, ride) => sum + (ride.offerAmount || 0), 0);
            
            // Update UI
            document.getElementById('totalCustomers').textContent = totalCustomers;
            document.getElementById('totalRides').textContent = totalRides;
            document.getElementById('activeRiders').textContent = activeRiders;
            document.getElementById('totalEarnings').textContent = 'Rs ' + totalEarnings;
            
            document.getElementById('customerChange').textContent = `+${APP_STATE.customers.length} Total`;
            document.getElementById('rideChange').textContent = `+${todayRides} Today`;
            document.getElementById('riderChange').textContent = `${activeRiders} Online`;
            document.getElementById('earningChange').textContent = `+Rs ${todayEarnings} Today`;
        }

        function loadRidersTable() {
            const table = document.getElementById('riderTable');
            table.innerHTML = '';
            
            APP_STATE.riders.forEach(rider => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${rider.id}</td>
                    <td>${rider.name}</td>
                    <td>${rider.phone}</td>
                    <td>
                        <span class="status-indicator ${rider.status === 'online' ? 'status-online' : 'status-offline'}">
                            <i class="fas fa-circle"></i> ${rider.status}
                        </span>
                    </td>
                    <td>${rider.vehicleNumber} (${rider.vehicleType})</td>
                    <td>${rider.rating} </td>
                    <td>
                        <button class="btn btn-danger btn-sm" onclick="deleteRider('${rider.id}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                table.appendChild(row);
            });
        }

        function loadRidesTable() {
            const table = document.getElementById('ridesTable');
            table.innerHTML = '';
            
            // Show recent 20 rides
            const recentRides = APP_STATE.rides
                .sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp))
                .slice(0, 20);
            
            recentRides.forEach(ride => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>R${ride.id.toString().slice(-6)}</td>
                    <td>${ride.customer.name}</td>
                    <td>${ride.rider ? ride.rider.name : 'N/A'}</td>
                    <td>${ride.pickup ? 'Location' : 'N/A'}  ${ride.destination}</td>
                    <td>Rs ${ride.offerAmount || 'N/A'}</td>
                    <td>
                        <span class="status-indicator ${ride.status === 'completed' ? 'status-completed' : 
                            ride.status === 'active' ? 'status-online' : 'status-pending'}">
                            ${ride.status}
                        </span>
                    </td>
                    <td>${new Date(ride.timestamp).toLocaleTimeString()}</td>
                `;
                table.appendChild(row);
            });
        }

        function loadComplaintsTable() {
            const table = document.getElementById('complaintsTable');
            table.innerHTML = '';
            
            if (APP_STATE.complaints.length === 0) {
                table.innerHTML = `
                    <tr>
                        <td colspan="7" style="text-align: center; padding: 40px; color: var(--gray);">
                            No complaints yet
                        </td>
                    </tr>
                `;
                return;
            }
            
            APP_STATE.complaints.forEach(complaint => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>C${complaint.id.toString().slice(-6)}</td>
                    <td>${complaint.customerName}</td>
                    <td>${complaint.riderName}</td>
                    <td style="max-width: 200px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
                        ${complaint.details}
                    </td>
                    <td>${''.repeat(complaint.rating)}${''.repeat(5-complaint.rating)}</td>
                    <td>
                        <span class="status-indicator ${complaint.resolved ? 'status-completed' : 'status-pending'}">
                            ${complaint.resolved ? 'Resolved' : 'Pending'}
                        </span>
                    </td>
                    <td>
                        <button class="btn btn-primary btn-sm" onclick="resolveComplaint(${complaint.id})">
                            ${complaint.resolved ? 'Reopen' : 'Resolve'}
                        </button>
                    </td>
                `;
                table.appendChild(row);
            });
        }

        function openAddRiderModal() {
            document.getElementById('addRiderModal').style.display = 'flex';
        }

        function generateRiderId() {
            const riderId = Math.floor(10000 + Math.random() * 90000).toString();
            document.getElementById('newRiderId').value = riderId;
        }

        function addNewRider() {
            const name = document.getElementById('newRiderName').value;
            const phone = document.getElementById('newRiderPhone').value;
            const vehicleType = document.getElementById('newRiderVehicle').value;
            const vehicleNumber = document.getElementById('newRiderVehicleNo').value;
            const riderId = document.getElementById('newRiderId').value;
            const password = document.getElementById('newRiderPassword').value;
            
            if (!name || !phone || !vehicleNumber || !riderId || !password) {
                showToast('Please fill all fields', 'error');
                return;
            }
            
            const newRider = {
                id: riderId,
                name,
                phone,
                password,
                status: 'offline',
                rating: 5.0,
                totalRides: 0,
                vehicleType,
                vehicleNumber,
                location: { lat: 34.368, lng: 73.471 },
                liveLocation: null,
                earnings: 0,
                joinedDate: new Date().toISOString().split('T')[0]
            };
            
            APP_STATE.riders.push(newRider);
            saveData('riders');
            
            showToast('Rider added successfully', 'success');
            closeModal('addRiderModal');
            loadRidersTable();
            loadAdminStats();
            
            // Clear form
            document.getElementById('newRiderName').value = '';
            document.getElementById('newRiderPhone').value = '';
            document.getElementById('newRiderVehicleNo').value = '';
            document.getElementById('newRiderPassword').value = '';
        }

        function deleteRider(riderId) {
            if (confirm('Are you sure you want to delete this rider?')) {
                APP_STATE.riders = APP_STATE.riders.filter(r => r.id !== riderId);
                saveData('riders');
                
                showToast('Rider deleted', 'success');
                loadRidersTable();
                loadAdminStats();
            }
        }

        // Complaints
        function openComplainModal() {
            // Populate riders dropdown
            const select = document.getElementById('complainRider');
            select.innerHTML = '<option value="">Select a rider</option>';
            
            APP_STATE.riders.forEach(rider => {
                const option = document.createElement('option');
                option.value = rider.id;
                option.textContent = `${rider.name} (${rider.vehicleNumber})`;
                select.appendChild(option);
            });
            
            document.getElementById('complainModal').style.display = 'flex';
            
            // Initialize rating stars
            document.querySelectorAll('.rating-star').forEach(star => {
                star.addEventListener('click', function() {
                    const rating = parseInt(this.dataset.rating);
                    document.getElementById('complainRating').value = rating;
                    
                    // Update stars display
                    document.querySelectorAll('.rating-star').forEach((s, index) => {
                        if (index < rating) {
                            s.classList.add('active');
                        } else {
                            s.classList.remove('active');
                        }
                    });
                });
            });
        }

        function submitComplaint() {
            const email = document.getElementById('complainEmail').value;
            const riderId = document.getElementById('complainRider').value;
            const rating = parseInt(document.getElementById('complainRating').value);
            const details = document.getElementById('complainDetails').value;
            
            if (!email || !riderId || rating === 0 || !details) {
                showToast('Please fill all fields', 'error');
                return;
            }
            
            const rider = APP_STATE.riders.find(r => r.id === riderId);
            
            const complaint = {
                id: Date.now(),
                customerName: APP_STATE.currentUser.name,
                customerEmail: email,
                riderId,
                riderName: rider ? rider.name : 'Unknown',
                rating,
                details,
                resolved: false,
                timestamp: new Date().toISOString()
            };
            
            APP_STATE.complaints.push(complaint);
            saveData('complaints');
            
            showToast('Complaint submitted successfully', 'success');
            closeModal('complainModal');
        }

        function resolveComplaint(complaintId) {
            const complaint = APP_STATE.complaints.find(c => c.id === complaintId);
            if (complaint) {
                complaint.resolved = !complaint.resolved;
                saveData('complaints');
                loadComplaintsTable();
                showToast(`Complaint ${complaint.resolved ? 'resolved' : 'reopened'}`, 'success');
            }
        }

        // Notifications
        function updateNotificationCount() {
            let count = 0;
            
            if (APP_STATE.userRole === 'customer') {
                count = APP_STATE.notifications.filter(n => 
                    n.customerPhone === APP_STATE.currentUser.phone && !n.read
                ).length;
                document.getElementById('notificationCount').textContent = count;
            } else if (APP_STATE.userRole === 'rider') {
                count = APP_STATE.notifications.filter(n => 
                    n.riderId === APP_STATE.currentUser.id && !n.read
                ).length;
                document.getElementById('riderNotificationCount').textContent = count;
            }
        }

        function showNotifications() {
            const modal = document.getElementById('notificationModal');
            const list = document.getElementById('notificationList');
            list.innerHTML = '';
            
            let userNotifications = [];
            
            if (APP_STATE.userRole === 'customer') {
                userNotifications = APP_STATE.notifications.filter(n => 
                    n.customerPhone === APP_STATE.currentUser.phone
                ).slice(0, 20);
            } else if (APP_STATE.userRole === 'rider') {
                userNotifications = APP_STATE.notifications.filter(n => 
                    n.riderId === APP_STATE.currentUser.id
                ).slice(0, 20);
            }
            
            if (userNotifications.length === 0) {
                list.innerHTML = '<p style="text-align: center; color: var(--gray); padding: 40px;">No notifications</p>';
            } else {
                userNotifications.forEach(notification => {
                    const div = document.createElement('div');
                    div.className = 'notification-item';
                    div.style.padding = '15px';
                    div.style.borderBottom = '1px solid var(--light-gray)';
                    div.style.backgroundColor = notification.read ? 'transparent' : 'rgba(46, 125, 50, 0.05)';
                    
                    div.innerHTML = `
                        <div style="font-weight: 600; color: var(--primary);">${notification.type.replace('_', ' ').toUpperCase()}</div>
                        <div style="margin: 5px 0;">${notification.message}</div>
                        <div style="font-size: 12px; color: var(--gray);">
                            ${new Date(notification.timestamp).toLocaleString()}
                        </div>
                    `;
                    
                    list.appendChild(div);
                    
                    // Mark as read on click
                    div.addEventListener('click', () => {
                        notification.read = true;
                        saveData('notifications');
                        updateNotificationCount();
                    });
                });
            }
            
            modal.style.display = 'flex';
        }

        // Utility Functions
        function showLoading(text = 'Loading...') {
            document.getElementById('loadingText').textContent = text;
            document.getElementById('loadingOverlay').style.display = 'flex';
        }

        function hideLoading() {
            document.getElementById('loadingOverlay').style.display = 'none';
        }

        function showToast(message, type = 'info') {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toastMessage');
            
            toastMessage.textContent = message;
            toast.className = `toast ${type}`;
            toast.style.display = 'flex';
            
            // Auto-hide after 3 seconds
            setTimeout(() => {
                toast.style.display = 'none';
            }, 3000);
        }

        function showError(elementId, message) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.style.display = 'block';
            
            setTimeout(() => {
                element.style.display = 'none';
            }, 3000);
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        function logout() {
            // If rider is online, go offline
            if (APP_STATE.userRole === 'rider' && APP_STATE.currentUser.status === 'online') {
                APP_STATE.currentUser.status = 'offline';
                APP_STATE.currentUser.liveLocation = null;
                
                // Update in array
                const riderIndex = APP_STATE.riders.findIndex(r => r.id === APP_STATE.currentUser.id);
                if (riderIndex !== -1) {
                    APP_STATE.riders[riderIndex] = APP_STATE.currentUser;
                    saveData('riders');
                }
                
                // Clear interval
                if (APP_STATE.liveLocationInterval) {
                    clearInterval(APP_STATE.liveLocationInterval);
                    APP_STATE.liveLocationInterval = null;
                }
            }
            
            // Reset state
            APP_STATE.currentUser = null;
            APP_STATE.userRole = null;
            APP_STATE.currentRide = null;
            
            showToast('Logged out successfully', 'success');
            showWelcomeScreen();
        }

        // Initialize app
        window.onload = initApp;
    </script>
</body>
</html>